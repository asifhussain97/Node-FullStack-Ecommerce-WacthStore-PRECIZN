
<%- include('../layouts/headeruser.ejs') %>      
<!-- Add this in your HTML or EJS file -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<style>
.image-container {
  width: 440px;
  height: 470px;
    overflow: hidden;
    /* border: 1px solid #ccc; Optional: Add a border for visualization */
}

.zoom-container {
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.image-zoom {
    width: 100%;
    height: 100%;
    transition: transform 0.3s ease;
}

.image-zoom:hover {
    transform: scale(1.8); /* Adjust the scale factor for zoom effect */
}
.thumbnail {
    width: 50px;
    height: 50px;
    margin-right: 10px;
    border: 1px solid black;  
    border-radius: 10%;
  }
  .custom-col {
    flex: 0 0 5.5%; /* Adjust the width percentage as needed */
    max-width: 5.5%;
  }
                  /* .checked {
                    color: orange;
                  } */
</style>
  <div style="margin-top: 150px; margin-bottom: 200px;" class=" site-section">
    <div class="container">
      <div class="row">
        <div class="col-1 custom-col d-flex  flex-column justify-content-center">
          <% for (let i = 0; i < products.image.length; i++) {%>        

          <img src='/assets/img/product/<%= products.image[i]%>' onclick="changeMainImage('<%= products.image[i] %>')" alt="Thumbnail" class="my-3 thumbnail">
          <% } %>        

        </div>

        <div class="col-md-6 image-container">
          <div class="zoom-container">
              <img src='/assets/img/product/<%= products.image[0]%>' id="mainImage" alt="Image" class="image-zoom">
          </div>
        </div>
        <div class="col-md-6 ms-5">
          <h2 class="text-black">
            <%= products.name %>
          </h2>
          <p></p>
          <p class="mb-4"><%= products.description %></p>

          <div class="product_sort_info font-xs mb-4">
            <ul style="list-style: none; ">
                <li class="mb-10 text-muted"><i class="fa-solid fa-crown"></i> 1 Year Warranty</li>
                <li class="mb-10 text-muted"><i class="fa-solid fa-rotate"></i> 7 Day Return
                    Policy</li>
                <li class="text-muted"><i class="fa-regular fa-credit-card"></i> Cash on Delivery available
                </li>
            </ul>
          </div>
          <%if( products.discountStatus==true && new Date(products.discountStart) <= new Date() && new Date() <= new Date(products.discountEnd)){
            const percentageOff = ((products.price - products.discountPrice) / products.price) * 100; %>
          <p>
            <strong class="text-dark h4">₹<%= products.discountPrice %></strong>
            - <s class="text-secondary h6">₹<%= products.price %></s> <span style="font-size: 12px; background-color: rgb(255, 255, 255); " class=" text-success"><%= percentageOff.toFixed(2) %>% Off</span>
          </p>
          <% } else { %>
            <p>
              <strong class="text-dark h4">₹<%= products.price %></strong>
            </p>
          <% } %>

            <% if (products.stock<=0) { %>
              <div class="text-center">
                  <a class="text-danger text-decoration-none mt-auto" href="#">Out of Stock</a>
              </div>
          <% } else { %>
          <div class="d-flex">
            <form id="myForm">
              <input type="hidden" value="<%= products._id %>"name="productData_id" id="">
              <div class="mt-2 d-flex detail-extralink">
                <%  if(!existingCartItem){ %>
                    <input type="number" name="qty" class="w-25 me-2" value="1" min="1" max="10">
                  <% } else  {%>
                    <input type="hidden" name="qty" value="0">
                  <% }%>
                  <div class=" product-extra-link2 my-1">

                      <button type="submit" class="btn btn-outline-dark btn-sm btn-product btn-cart"><i class="fa-solid fa-cart-shopping"></i> <%= existingCartItem ? 'Go To Cart' : 'Add To Cart' %></button>


                      <button aria-label="Add To Wishlist" class=" btn action-btn hover-up p-3  "
                          ><i class="fi-rs-heart  "></i></button>
                  </div>
              </div>
            </form>
          </div>
          <% } %>

        </div>
      </div>
    </div>
  </div>
  <script>
// Function to show toast alert
function showToast(message, type) {
    Toastify({
        text: message,
        duration: 3000, // Duration in milliseconds
        gravity: 'bottom', // Position: 'top', 'bottom', 'left', 'right'
        backgroundColor: type === 'success' ? '#33cc33' : '#ff3333', // Change colors based on success/failure
    }).showToast();
}

// Function to handle form submission
function addcartform(event) {
    event.preventDefault();
    const formId = event.target.id; // Get the form ID that triggered the event
    const productData_id = document.querySelector(`#${formId} [name="productData_id"]`).value;
    const qty = document.querySelector(`#${formId} [name="qty"]`).value;

    fetch('/cart', {
        method: 'POST',
        body: JSON.stringify({ productData_id, qty }),
        headers: {
            'Content-Type': 'application/json',
        },
    })
    .then((response) => response.json())
    .then((data) => {
      
        if (!data.existing) {
            if (data.success) {
                showToast(data.message, 'success');
            } else {
                showToast(data.message, 'error');
            }
        } else {
            window.location.href = '/cart';
        }
    })
    .catch((error) => {
        console.error('Error:', error);
        showToast('Internal server error', 'error');
    });
}
// Add event listener to your form submission
document.getElementById('myForm').addEventListener('submit', addcartform);


    function changeMainImage(imageUrl) {
    const mainImage = document.getElementById('mainImage');
    mainImage.src = `/assets/img/product/${imageUrl}`;
    }
    document.querySelector('.image-zoom').addEventListener('mousemove', function(e) {
      const { left, top, width, height } = this.getBoundingClientRect();
      const x = (e.clientX - left) / width * 100;
      const y = (e.clientY - top) / height * 100;

      this.style.transformOrigin = `${x}% ${y}%`;
    });
  </script>
  <%- include('../layouts/footeruser.ejs') %>
